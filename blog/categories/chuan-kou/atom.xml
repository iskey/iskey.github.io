<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: 串口 | Iskey's Blog]]></title>
  <link href="http://iskey.github.io/blog/categories/chuan-kou/atom.xml" rel="self"/>
  <link href="http://iskey.github.io/"/>
  <updated>2019-07-07T15:43:55+00:00</updated>
  <id>http://iskey.github.io/</id>
  <author>
    <name><![CDATA[Iskey]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[调试串口转应用串口]]></title>
    <link href="http://iskey.github.io/blog/2016/04/22/debug-serial-to-general/"/>
    <updated>2016-04-22T20:36:00+00:00</updated>
    <id>http://iskey.github.io/blog/2016/04/22/debug-serial-to-general</id>
    <content type="html"><![CDATA[<h2>调试串口转应用串口</h2>

<pre><code>#include "stdio.h"
#include "sys/ioctl.h"
#include "fcntl.h"

#include "termios.h"
#include "unistd.h"

#define ECHOFLAGS (ECHO | ECHOE | ECHOK | ECHONL)

int main()
{
    int fd;
    int ret;
    char buf[100];
    struct termios term;

    fd= open("/dev/pts/0",O_RDONLY);
    if(fd&lt;=0){
        printf("Error. open /dev/pts/0.\n");
        goto err;
    }
    ioctl(fd, TIOCCONS);
    close(fd);

    fd= open("/dev/ttyS0",O_RDONLY);
    if(fd&lt;=0){
    fd= open("/dev/ttyS0",O_RDONLY);
    if(fd&lt;=0){
        printf("Error. open /dev/console.\n");
        goto err;
    }

    ret= tcgetattr(fd, &amp;term);
    if(-1== ret){
        printf("tcgetattr error.\n");
        goto err;
    }
    cfmakeraw(&amp;term);
    term.c_lflag&amp;= ~ECHOFLAGS;
    tcsetattr(fd, TCSAFLUSH, &amp;term);
    tcsetattr(fd, TCSANOW, &amp;term);
    if(-1== ret){
        printf("tcsetattr error.\n");
        goto err;
    }

    ret= read(fd, buf, 1);
    if(ret== -1){
        perror("read error.\n");    
        goto err;
    }

    while(*buf!='\n')
    {
        ret= read(fd, buf, 1);
        if(ret== -1){
            perror("read error1.\n");
            goto err;
        }
        printf("%02x\n",*buf);
    }
    ioctl(fd, TIOCCONS);
    close(fd);

    return 0;
err:
    return -1;
}
</code></pre>
]]></content>
  </entry>
  
</feed>
