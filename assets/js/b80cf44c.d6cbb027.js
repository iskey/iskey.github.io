"use strict";(self.webpackChunk=self.webpackChunk||[]).push([[3221],{3905:(e,n,a)=>{a.d(n,{Zo:()=>s,kt:()=>u});var t=a(7294);function d(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function r(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function o(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?r(Object(a),!0).forEach((function(n){d(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):r(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function c(e,n){if(null==e)return{};var a,t,d=function(e,n){if(null==e)return{};var a,t,d={},r=Object.keys(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||(d[a]=e[a]);return d}(e,n);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(t=0;t<r.length;t++)a=r[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(d[a]=e[a])}return d}var i=t.createContext({}),l=function(e){var n=t.useContext(i),a=n;return e&&(a="function"==typeof e?e(n):o(o({},n),e)),a},s=function(e){var n=l(e.components);return t.createElement(i.Provider,{value:n},e.children)},m={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},y=t.forwardRef((function(e,n){var a=e.components,d=e.mdxType,r=e.originalType,i=e.parentName,s=c(e,["components","mdxType","originalType","parentName"]),y=l(a),u=d,p=y["".concat(i,".").concat(u)]||y[u]||m[u]||r;return a?t.createElement(p,o(o({ref:n},s),{},{components:a})):t.createElement(p,o({ref:n},s))}));function u(e,n){var a=arguments,d=n&&n.mdxType;if("string"==typeof e||d){var r=a.length,o=new Array(r);o[0]=y;var c={};for(var i in n)hasOwnProperty.call(n,i)&&(c[i]=n[i]);c.originalType=e,c.mdxType="string"==typeof e?e:d,o[1]=c;for(var l=2;l<r;l++)o[l]=a[l];return t.createElement.apply(null,o)}return t.createElement.apply(null,a)}y.displayName="MDXCreateElement"},8978:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>i,contentTitle:()=>o,default:()=>m,frontMatter:()=>r,metadata:()=>c,toc:()=>l});var t=a(7462),d=(a(7294),a(3905));const r={title:"Caddy\u670d\u52a1\u5668",date:"2022-02-08 11:28:15 +0800",comments:!0,tags:["cert"]},o="Caddy\u670d\u52a1\u5668",c={unversionedId:"Linux/System/Caddy\u670d\u52a1\u5668",id:"Linux/System/Caddy\u670d\u52a1\u5668",title:"Caddy\u670d\u52a1\u5668",description:"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4f7f\u7528docker\u6765\u4f7f\u7528Caddy\u670d\u52a1\u5668\u7684\u65b9\u6cd5\u3002",source:"@site/docs/Linux/System/Caddy\u670d\u52a1\u5668.md",sourceDirName:"Linux/System",slug:"/Linux/System/Caddy\u670d\u52a1\u5668",permalink:"/Linux/System/Caddy\u670d\u52a1\u5668",draft:!1,editUrl:"https://github.com/iskey/docusaurus-2/tree/main/packages/create-docusaurus/templates/shared/docs/Linux/System/Caddy\u670d\u52a1\u5668.md",tags:[{label:"cert",permalink:"/tags/cert"}],version:"current",frontMatter:{title:"Caddy\u670d\u52a1\u5668",date:"2022-02-08 11:28:15 +0800",comments:!0,tags:["cert"]},sidebar:"tutorialSidebar",previous:{title:"python\u83b7\u53d6\u5f53\u524d\u884c\u53f7",permalink:"/Linux/Python/python\u83b7\u53d6\u5f53\u524d\u884c\u53f7"},next:{title:"IPSec\u4f7f\u7528",permalink:"/Linux/System/IPSec\u4f7f\u7528"}},i={},l=[{value:"Add user for docker",id:"add-user-for-docker",level:2},{value:"Create caddy file",id:"create-caddy-file",level:2},{value:"Run caddy",id:"run-caddy",level:2},{value:"\u91cd\u65b0\u7f16\u8bd1caddy\u5bb9\u5668\u955c\u50cf",id:"\u91cd\u65b0\u7f16\u8bd1caddy\u5bb9\u5668\u955c\u50cf",level:2},{value:"\u7f16\u8bd1caddy_with_godaddy\u6a21\u5757",id:"\u7f16\u8bd1caddy_with_godaddy\u6a21\u5757",level:3},{value:"\u6267\u884c\u7f16\u8bd1\u547d\u4ee4",id:"\u6267\u884c\u7f16\u8bd1\u547d\u4ee4",level:3},{value:"caddy\u81ea\u52a8\u83b7\u53d6\u8bc1\u4e66",id:"caddy\u81ea\u52a8\u83b7\u53d6\u8bc1\u4e66",level:2},{value:"\u624b\u52a8\u83b7\u53d6\u8bc1\u4e66",id:"\u624b\u52a8\u83b7\u53d6\u8bc1\u4e66",level:2}],s={toc:l};function m(e){let{components:n,...a}=e;return(0,d.kt)("wrapper",(0,t.Z)({},s,a,{components:n,mdxType:"MDXLayout"}),(0,d.kt)("h1",{id:"caddy\u670d\u52a1\u5668"},"Caddy\u670d\u52a1\u5668"),(0,d.kt)("p",null,"\u672c\u6587\u4e3b\u8981\u4ecb\u7ecd\u4f7f\u7528docker\u6765\u4f7f\u7528Caddy\u670d\u52a1\u5668\u7684\u65b9\u6cd5\u3002"),(0,d.kt)("h2",{id:"add-user-for-docker"},"Add user for docker"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"sudo groupadd docker\nsudo usermod -aG docker\nnewgrp docker\n")),(0,d.kt)("h2",{id:"create-caddy-file"},"Create caddy file"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-json",metastring:"title=/etc/caddy/Caddyfile",title:"/etc/caddy/Caddyfile"},"mydomain.com:443 {\n    tls xxxxxx@qq.com\n    root * /data/html\n\n    # Enable the static file server.\n    file_server browse\n}\n\n")),(0,d.kt)("h2",{id:"run-caddy"},"Run caddy"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"docker container stop iskey_caddy\ndocker container rm iskey_caddy\ndocker run --name iskey_caddy -d -p 8443:443 -p 80:80 -v /usr1/caddy/caddy_data:/data -v /usr1/caddy/Caddyfile:/etc/caddy/Caddyfile caddy:latest\n")),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"ls /usr1/caddy/caddy_data/\ncaddy  html\n")),(0,d.kt)("p",null,(0,d.kt)("a",{parentName:"p",href:"https://caddyserver.com/docs/"},"\u5b98\u65b9\u6587\u6863")),(0,d.kt)("h2",{id:"\u91cd\u65b0\u7f16\u8bd1caddy\u5bb9\u5668\u955c\u50cf"},"\u91cd\u65b0\u7f16\u8bd1caddy\u5bb9\u5668\u955c\u50cf"),(0,d.kt)("h3",{id:"\u7f16\u8bd1caddy_with_godaddy\u6a21\u5757"},"\u7f16\u8bd1caddy_with_godaddy\u6a21\u5757"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-Dockerfile"},"FROM docker.io/library/golang:latest AS builder\n#ENV XCADDY_RACE_DETECTOR 1\n#ENV XCADDY_DEBUG 1\nENV http_proxy http://x.x.x.x:9090\nENV https_proxy http://x.x.x.x:9090\n\nRUN go install github.com/caddyserver/xcaddy/cmd/xcaddy@latest\n\nRUN xcaddy build \\\n    --with github.com/caddy-dns/godaddy\n\nFROM docker.io/library/caddy:latest\n\nCOPY --from=builder /go/caddy /usr/bin/caddy\n")),(0,d.kt)("h3",{id:"\u6267\u884c\u7f16\u8bd1\u547d\u4ee4"},"\u6267\u884c\u7f16\u8bd1\u547d\u4ee4"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"podman build . --loglevel 3 -t caddy_with_godaddy:latest\n\nor\n\ndocker build . -t caddy_with_godaddy:latest\n")),(0,d.kt)("h2",{id:"caddy\u81ea\u52a8\u83b7\u53d6\u8bc1\u4e66"},"caddy\u81ea\u52a8\u83b7\u53d6\u8bc1\u4e66"),(0,d.kt)("p",null,"Caddy\u914d\u7f6e\u5982\u4e0b\uff0c\u53ef\u4ee5\u81ea\u52a8\u751f\u6210\u4e3b\u57df\u540d\u8bc1\u4e66\u548c\u5b50\u57df\u540d\u8bc1\u4e66\uff0c\u524d\u63d0\u662f\u8981\u4f7f\u7528\u5982\u4e0a\u6784\u5efa\u7684\u5e26\u6709godaddy\u7684\u6a21\u5757\u7684caddy\u955c\u50cf"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre"},"*.mydomain.com:443 {\n    tls {\n      dns godaddy KEY:SK\n    }\n    #root * /data/html\n    reverse_proxy localhost:443\n\n    # Enable the static file server.\n    #file_server  browse\n}\n\nmydomain.com:443 {\n    tls {\n      dns godaddy KEY:SK\n    }\n    root * /data/html\n\n    # Enable the static file server.\n    file_server  browse\n}\n")),(0,d.kt)("h2",{id:"\u624b\u52a8\u83b7\u53d6\u8bc1\u4e66"},"\u624b\u52a8\u83b7\u53d6\u8bc1\u4e66"),(0,d.kt)("p",null,"\u53c2\u8003\u624b\u52a8\u7533\u8bf7\u57df\u540d\u8fdb\u884c\u591a\u57df\u540d\u7533\u8bf7\uff0c[","[Lets Encrypt\u8bc1\u4e66\u751f\u6210#DNS\u624b\u52a8\u7533\u8bf7\u57df\u540d/\u6cdb\u57df\u540d\u8bc1\u4e66]","]"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre",className:"language-bash"},"acme.sh --issue -d mydomain.com -d *.mydomain.com --dns --yes-I-know-dns-manual-mode-enough-go-ahead-please\n\nacme.sh --renew -d mydomain.com -d *.mydomain.com --yes-I-know-dns-manual-mode-enough-go-ahead-please\n")),(0,d.kt)("p",null,"acme.sh --renew -d mydomain.com -d *.mydomain.com --yes-I-know-dns-manual-mode-enough-go-ahead-please"),(0,d.kt)("pre",null,(0,d.kt)("code",{parentName:"pre"},"[Mon Jan 29 18:33:40 CST 2024] The domain 'mydomain.com' seems to have a ECC cert already, lets use ecc cert.\n[Mon Jan 29 18:33:40 CST 2024] Renew: 'mydomain.com'\n[Mon Jan 29 18:33:40 CST 2024] Renew to Le_API=https://acme.zerossl.com/v2/DV90\n[Mon Jan 29 18:33:41 CST 2024] Using CA: https://acme.zerossl.com/v2/DV90\n[Mon Jan 29 18:33:41 CST 2024] Multi domain='DNS:mydomain.com,DNS:*.mydomain.com'\n[Mon Jan 29 18:33:41 CST 2024] Getting domain auth token for each domain\n[Mon Jan 29 18:33:41 CST 2024] Verifying: mydomain.com\n[Mon Jan 29 18:33:52 CST 2024] Processing, The CA is processing your order, please just wait. (1/30)\n[Mon Jan 29 18:33:56 CST 2024] Success\n[Mon Jan 29 18:33:56 CST 2024] Verifying: *.mydomain.com\n[Mon Jan 29 18:33:57 CST 2024] Processing, The CA is processing your order, please just wait. (1/30)\n[Mon Jan 29 18:34:01 CST 2024] Success\n[Mon Jan 29 18:34:01 CST 2024] Verify finished, start to sign.\n[Mon Jan 29 18:34:01 CST 2024] Lets finalize the order.\n[Mon Jan 29 18:34:01 CST 2024] Le_OrderFinalize='https://acme.zerossl.com/v2/DV90/order/X25Dctgiv7yHJvG1maL_xw/finalize'\n[Mon Jan 29 18:34:03 CST 2024] Order status is processing, lets sleep and retry.\n[Mon Jan 29 18:34:03 CST 2024] Retry after: 15\n[Mon Jan 29 18:34:19 CST 2024] Polling order status: https://acme.zerossl.com/v2/DV90/order/X25Dctgiv7yHJvG1maL_xw\n[Mon Jan 29 18:34:23 CST 2024] Downloading cert.\n[Mon Jan 29 18:34:23 CST 2024] Le_LinkCert='https://acme.zerossl.com/v2/DV90/cert/Ew9fRRhMHdJOi2Bl82C_Jw'\n[Mon Jan 29 18:34:26 CST 2024] Cert success.\n-----BEGIN CERTIFICATE-----\nMIIECjCCA4+gAwIBAgIRAP4YWVi7bVqNymluolWZ2PwwCgYIKoZIzj0EAwMwSzEL\nMAkGA1UEBhMCQVQxEDAOBgNVBAoTB1plcm9TU0wxKjAoBgNVBAMTIVplcm9TU0wg\nRUNDIERvbWFpbiBTZWN1cmUgU2l0ZSBDQTAeFw0yNDAxMjkwMDAwMDBaFw0yNDA0\nMjgyMzU5NTlaMBcxFTATBgNVBAMTDGlzbm9rZXkuc2hvcDBZMBMGByqGSM49AgEG\nCCqGSM49AwEHA0IABAbGUpOSp5jrv4nTcQYkWPfziDp9RtipNc9dsSgg3OKIqO7y\naeh7134NCeU2RDgQy356RcuLdk6ibXB46u2+ZcCjggKGMIICgjAfBgNVHSMEGDAW\ngBQPa+ZLzjlHrvZ+kB558DCRkshfozAdBgNVHQ4EFgQUxzv7cTU60ruXUArPXjX4\n6OPKiwswDgYDVR0PAQH/BAQDAgeAMAwGA1UdEwEB/wQCMAAwHQYDVR0lBBYwFAYI\nKwYBBQUHAwEGCCsGAQUFBwMCMEkGA1UdIARCMEAwNAYLKwYBBAGyMQECAk4wJTAj\nBggrBgEFBQcCARYXaHR0cHM6Ly9zZWN0aWdvLmNvbS9DUFMwCAYGZ4EMAQIBMIGI\nBggrBgEFBQcBAQR8MHowSwYIKwYBBQUHMAKGP2h0dHA6Ly96ZXJvc3NsLmNydC5z\nZWN0aWdvLmNvbS9aZXJvU1NMRUNDRG9tYWluU2VjdXJlU2l0ZUNBLmNydDArBggr\nBgEFBQcwAYYfaHR0cDovL3plcm9zc2wub2NzcC5zZWN0aWdvLmNvbTCCAQIGCisG\nAQQB1nkCBAIEgfMEgfAA7gB1AHb/iD8KtvuVUcJhzPWHujS0pM27KdxoQgqf5mdM\nWjp0AAABjVTIiGoAAAQDAEYwRAIgCyY1BwWJCO8pHdzg7WKNvy6gKJvjT4JVUeDN\ncUKjdHECIB5NE2B9dDL5NL+gSlWjmkHeA5cQWR9jEloRMD2xWgz7AHUAO1N3dT4t\nuYBOizBbBv5AO2fYT8P0x70ADS1yb+H61BcAAAGNVMiJIgAABAMARjBEAiAldBho\nI28jkrVpRB9hqj7CyLLQzLWwt+9U0CUYCarxxAIgCqeW4O2R374ox/2FzRiHdy1p\n1rgQf+NZNYg/+vZzg74wJwYDVR0RBCAwHoIMaXNub2tleS5zaG9wgg4qLmlzbm9r\nZXkuc2hvcDAKBggqhkjOPQQDAwNpADBmAjEAh46y+VcCPntVv29jn862bMhaYu/s\nMXZpc+x78579NGEHPxwl7d95lRpyzy2MBGOiAjEA7fz/gWhH+g9Jg7aNqKW6PgdR\n92uyLKNDh4e2Ve/O61ytdZrljjINdLTCbNL3G8Pd\n-----END CERTIFICATE-----\n[Mon Jan 29 18:34:26 CST 2024] Your cert is in: /home/iskey/.acme.sh/mydomain.com_ecc/mydomain.com.cer\n[Mon Jan 29 18:34:26 CST 2024] Your cert key is in: /home/iskey/.acme.sh/mydomain.com_ecc/mydomain.com.key\n[Mon Jan 29 18:34:26 CST 2024] The intermediate CA cert is in: /home/iskey/.acme.sh/mydomain.com_ecc/ca.cer\n[Mon Jan 29 18:34:26 CST 2024] And the full chain certs is there: /home/iskey/.acme.sh/mydomain.com_ecc/fullchain.cer\n")))}m.isMDXComponent=!0}}]);